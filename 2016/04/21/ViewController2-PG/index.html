<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ViewController2-PG | 天晷</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Customizing the Transition Animations过渡动画提供应用界面变化可视化反馈。UIKit框架提供标准的过渡动画方式用于呈现VC，程序内也可以自定义过渡作为标准过渡的补充。
The Transition Animation Sequence过渡动画交换两个视图控制器视图内容，有两种类型的过渡：呈现和消失。
实现过渡动画需要抓取相关的对象信息，UIKit框架提供包含在过">
<meta property="og:type" content="article">
<meta property="og:title" content="ViewController2-PG">
<meta property="og:url" content="http://yoursite.com/2016/04/21/ViewController2-PG/index.html">
<meta property="og:site_name" content="天晷">
<meta property="og:description" content="Customizing the Transition Animations过渡动画提供应用界面变化可视化反馈。UIKit框架提供标准的过渡动画方式用于呈现VC，程序内也可以自定义过渡作为标准过渡的补充。
The Transition Animation Sequence过渡动画交换两个视图控制器视图内容，有两种类型的过渡：呈现和消失。
实现过渡动画需要抓取相关的对象信息，UIKit框架提供包含在过">
<meta property="og:image" content="http://7xsq10.com2.z0.glb.clouddn.com/vc_PG_F10_2.jpg">
<meta property="og:image" content="http://7xsq10.com2.z0.glb.clouddn.com/vc_PG_F10_3.jpg">
<meta property="og:updated_time" content="2016-04-22T14:00:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ViewController2-PG">
<meta name="twitter:description" content="Customizing the Transition Animations过渡动画提供应用界面变化可视化反馈。UIKit框架提供标准的过渡动画方式用于呈现VC，程序内也可以自定义过渡作为标准过渡的补充。
The Transition Animation Sequence过渡动画交换两个视图控制器视图内容，有两种类型的过渡：呈现和消失。
实现过渡动画需要抓取相关的对象信息，UIKit框架提供包含在过">
<meta name="twitter:image" content="http://7xsq10.com2.z0.glb.clouddn.com/vc_PG_F10_2.jpg">
  
    <link rel="alternative" href="/atom.xml" title="天晷" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">天晷</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">脑容量有限，清理出来装灵感吧！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ViewController2-PG" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/21/ViewController2-PG/" class="article-date">
  <time datetime="2016-04-21T15:07:24.000Z" itemprop="datePublished">2016-04-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ViewController2-PG
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Customizing-the-Transition-Animations"><a href="#Customizing-the-Transition-Animations" class="headerlink" title="Customizing the Transition Animations"></a>Customizing the Transition Animations</h2><p>过渡动画提供应用界面变化可视化反馈。UIKit框架提供标准的过渡动画方式用于呈现VC，程序内也可以自定义过渡作为标准过渡的补充。</p>
<h4 id="The-Transition-Animation-Sequence"><a href="#The-Transition-Animation-Sequence" class="headerlink" title="The Transition Animation Sequence"></a>The Transition Animation Sequence</h4><p>过渡动画交换两个视图控制器视图内容，有两种类型的过渡：呈现和消失。</p>
<p>实现过渡动画需要抓取相关的对象信息，UIKit框架提供包含在过渡动画内所有对象的默认信息，可以在应用内自定义全部或者部分对象。如果选择合适的对象组合，则只需要编写少量的代码就能实现过渡动画。</p>
<h6 id="Transitioning-Delegate"><a href="#Transitioning-Delegate" class="headerlink" title="Transitioning Delegate"></a>Transitioning Delegate</h6><p>Transitioning Delegate是过渡动画与自定义呈现的起动点。代理对象需要实现UIViewControllerTransitioningDelegate协议，并向UIKit框架提供以下信息对象：</p>
<ol>
<li>Animator objects：用于创建显示和消失视图控制器视图的动画，需要符合UIViewControllerAnimatedTransitioning协议。</li>
<li>Interactive animator objects：用于驱动自定义动画时间曲线，需要符合UIViewControllerInteractiveTransitioning协议。<strong>比较简便的方式是继承UIPercentDrivenInteractiveTransition，实现相应的事件处理即可</strong>。</li>
<li>Presentation controller：用于管理视图控制器在屏幕上的呈现方式。</li>
</ol>
<p>给视图控制器的 transitioningDelegate属性设置代理对象，告诉UIKit框架应用需要执行自定义过渡或者呈现方式。代理可以决定需要提供哪些对象，如果没有提供animator对象，UIKit框架使用由视图控制器 modalTransitionStyle属性提供的标准的过渡动画。</p>
<h6 id="Custom-Animation-Sequence"><a href="#Custom-Animation-Sequence" class="headerlink" title="Custom Animation Sequence"></a>Custom Animation Sequence</h6><p>当presented VC的transitioningDelegate属性提供一个有效的对象，UIKit框架则用自定义的动画呈现VC。UIKit框架调用 animationControllerForPresentedController:presentingController:sourceController:方法检索一个自定义的animator对象，如果有一个可用的对象，则按照以下流程执行：</p>
<ol>
<li>UIKit框架调用代理对象的interactionControllerForPresentation:方法，查看是否提供交互animator对象，如果没有提供相应对象，则框架采用非交互的动画驱动方式。</li>
<li>UIKit框架调用animator对象的 transitionDuration:方法获取动画执行时间。</li>
<li>UIKit框架调用适当的方法开始执行动画：（a）对象非交互式方式，调用animator对象的animateTransition:方法。（b）对交互方式，调用提供的交互对象的startInteractiveTransition:方式。</li>
<li>UIKit框架等待animator对象调用过渡上下文对象的 completeTransition:方法。<strong>当animator对象执行完成，则必须调用些方法，使用框架能够处理presentViewController:animated:completion:方法的completion内容</strong>。</li>
</ol>
<p>当消失一个视图控制器时，UIKit框架调用代理对象animationControllerForDismissedController:方法获取animator对象，并执行以下步骤：</p>
<ol>
<li>UIKit框架调用代理对象的interactionControllerForDismissal:方法，查看是否提供交互animator对象，如果没有提供相应对象，则框架采用非交互的动画驱动方式。</li>
<li>UIKit框架调用animator对象的 transitionDuration:方法获取动画执行时间。</li>
<li>UIKit框架调用适当的方法开始执行动画：（a）对象非交互式方式，调用animator对象的animateTransition:方法。（b）对交互方式，调用提供的交互对象的startInteractiveTransition:方式。</li>
<li>UIKit框架等待animator对象调用过渡上下文对象的 completeTransition:方法。<strong>当animator对象执行完成，则必须调用些方法，使用框架能够处理presentViewController:animated:completion:方法的completion内容</strong>。</li>
</ol>
<h6 id="Transitioning-Context-Object"><a href="#Transitioning-Context-Object" class="headerlink" title="Transitioning Context Object"></a>Transitioning Context Object</h6><p>在开始执行过渡动画之前，UIKit框架创建一个过渡上下文对象，并设置执行动画的相关信息。该对象实现了UIViewControllerContextTransitioning协议，包含了执行动画需要的必要信息。下图显示了上下文对象引用的对象信息：</p>
<p><img src="http://7xsq10.com2.z0.glb.clouddn.com/vc_PG_F10_2.jpg" alt="vc_PG_F10_2"></p>
<h6 id="Transition-Coordinator"><a href="#Transition-Coordinator" class="headerlink" title="Transition Coordinator"></a>Transition Coordinator</h6><p>对于内置或者自定义的过渡动画，UIKit框架创建了一个过渡时的协调器对象触发一些需要执行的附加动画。除了呈现或者消失视图控制器，当屏幕发生旋转或者VC尺寸发生变化也会引起transitions。此类的transitions主要是改变视图层次结构显示，跟踪变化并使用动画反馈给用户。transition coordinator对象只存在于过渡期间，通过被影响的VC的transitionCoordinator属性获得对象，对象实现UIViewControllerTransitionCoordinatorContext协议。对象引用的对象信息如下：</p>
<p><img src="http://7xsq10.com2.z0.glb.clouddn.com/vc_PG_F10_3.jpg" alt="vc_PG_F10_3"></p>
<h4 id="Presenting-a-View-Controller-Using-Custom-Animations"><a href="#Presenting-a-View-Controller-Using-Custom-Animations" class="headerlink" title="Presenting a View Controller Using Custom Animations"></a>Presenting a View Controller Using Custom Animations</h4><p>用自定义动画实现视图控制器的呈现，按照以下流程执行：</p>
<ol>
<li>创建一个视图控制器。</li>
<li>创建一个过渡代理对象赋值给被呈现的视图控制器的transitioningDelegate属性。代理对象的对应方法需要创建并返回animator对象。</li>
<li>最后调用presentViewController:animated:completion:方法。</li>
</ol>
<h4 id="Implementing-the-Transitioning-Delegate"><a href="#Implementing-the-Transitioning-Delegate" class="headerlink" title="Implementing the Transitioning Delegate"></a>Implementing the Transitioning Delegate</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (id&lt;UIViewControllerAnimatedTransitioning&gt;)</span><br><span class="line">    animationControllerForPresentedController:(UIViewController *)presented</span><br><span class="line">                         presentingController:(UIViewController *)presenting</span><br><span class="line">                             sourceController:(UIViewController *)source &#123;</span><br><span class="line">    MyAnimator* animator = [[MyAnimator alloc] init];</span><br><span class="line">    return animator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Animator-Objects"><a href="#Animator-Objects" class="headerlink" title="Animator Objects"></a>Animator Objects</h4><p>Animator Objects是一个任意实现了 UIViewControllerAnimatedTransitioning协议的对象。该对象创建一个固定时间周期的动画。其中animateTransition:方法需要负责实现：（a）获取动画需要的参数信息。（b）使用Core Anination或者UIView动画方法实现动画。（c）动画完成后清理。</p>
<h6 id="Getting-the-Animation-Parameters"><a href="#Getting-the-Animation-Parameters" class="headerlink" title="Getting the Animation Parameters"></a>Getting the Animation Parameters</h6><ol>
<li>调用viewControllerForKey: 方法使用“from”或者“to”关键字获取上下文里的VC。</li>
<li>调用containerView方法获取动画执行的父视图。</li>
<li>调用viewForKey:方法获取视图对象。</li>
<li>调用finalFrameForViewController:方法获取视图对象的最后位置信息。</li>
</ol>
<h6 id="Creating-the-Transition-Animations"><a href="#Creating-the-Transition-Animations" class="headerlink" title="Creating the Transition Animations"></a>Creating the Transition Animations</h6><p>设置代理代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">extension ViewController : UIViewControllerTransitioningDelegate &#123;</span><br><span class="line">    @objc private func buttonTouched(sender : UIButton) &#123;</span><br><span class="line">        let presentedVC = PresentedViewController()</span><br><span class="line">        presentedVC.transitioningDelegate = self</span><br><span class="line">        self.presentViewController(presentedVC, animated: true, completion: nil)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func animationControllerForPresentedController(presented: UIViewController, presentingController presenting: UIViewController, sourceController source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</span><br><span class="line">        animator.presenting = true</span><br><span class="line">        return animator</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func animationControllerForDismissedController(dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</span><br><span class="line">        animator.presenting = false</span><br><span class="line">        return animator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Animator代码如下：<br><strong>在编写代码时要注意，改变索引对象的值；dismiss时toViewStartFrame是（0，0，0，0），按照官方文档实现会消失后，会导致toView不显示</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class PreAnimator: NSObject, UIViewControllerAnimatedTransitioning &#123;</span><br><span class="line">    var presenting : Bool = false</span><br><span class="line">    </span><br><span class="line">    func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -&gt; NSTimeInterval &#123;</span><br><span class="line">        return 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func animateTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</span><br><span class="line">        let containerView = transitionContext.containerView()!</span><br><span class="line">        let fromVC = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!</span><br><span class="line">        let toVC = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</span><br><span class="line">        </span><br><span class="line">        let toView = transitionContext.viewForKey(UITransitionContextToViewKey)!</span><br><span class="line">        let fromView = transitionContext.viewForKey(UITransitionContextFromViewKey)!</span><br><span class="line">        </span><br><span class="line">        let containerFrame = containerView.frame</span><br><span class="line">        var toViewStartFrame = transitionContext.initialFrameForViewController(toVC)</span><br><span class="line">        let toViewFinalFrame = transitionContext.finalFrameForViewController(toVC)</span><br><span class="line">        var fromViewFinalFrame = transitionContext.finalFrameForViewController(fromVC)</span><br><span class="line">        </span><br><span class="line">        if presenting &#123;</span><br><span class="line">            toViewStartFrame.origin.x = containerFrame.size.width</span><br><span class="line">            toViewStartFrame.origin.y = containerFrame.size.height</span><br><span class="line">            containerView.insertSubview(toView, aboveSubview: fromView)  //此处改动</span><br><span class="line">            toView.frame = toViewStartFrame  //此处改动</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            fromViewFinalFrame = CGRectMake(containerFrame.width, containerFrame.height, toView.frame.width, toView.frame.height)</span><br><span class="line">            containerView.insertSubview(toView, belowSubview: fromView)  //此处改动</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        UIView.animateWithDuration(self.transitionDuration(transitionContext), animations: &#123;</span><br><span class="line">            if self.presenting &#123;</span><br><span class="line">                toView.frame = toViewFinalFrame</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                fromView.frame = fromViewFinalFrame</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;) &#123; (finished) in</span><br><span class="line">                let success = !transitionContext.transitionWasCancelled()</span><br><span class="line">                </span><br><span class="line">                if (self.presenting &amp;&amp; !success) || (!self.presenting &amp;&amp; success) &#123;</span><br><span class="line">                    toView.removeFromSuperview()</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                transitionContext.completeTransition(success)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Adding-Interactivity-to-Your-Transitions"><a href="#Adding-Interactivity-to-Your-Transitions" class="headerlink" title="Adding Interactivity to Your Transitions"></a>Adding Interactivity to Your Transitions</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class PercentAnimator: UIPercentDrivenInteractiveTransition &#123;</span><br><span class="line">    var context : UIViewControllerContextTransitioning!</span><br><span class="line">    </span><br><span class="line">    override func startInteractiveTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</span><br><span class="line">        super.startInteractiveTransition(transitionContext)</span><br><span class="line">        </span><br><span class="line">        context = transitionContext</span><br><span class="line">        </span><br><span class="line">        let panGesture = UIPanGestureRecognizer(target: self, action: #selector(self.handleSwipeUpdate(_:)))</span><br><span class="line">        panGesture.maximumNumberOfTouches = 1</span><br><span class="line">        </span><br><span class="line">        transitionContext.containerView()?.addGestureRecognizer(panGesture)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func handleSwipeUpdate(sender : UIPanGestureRecognizer) &#123;</span><br><span class="line">        let container = context.containerView()!</span><br><span class="line">        </span><br><span class="line">        switch sender.state &#123;</span><br><span class="line">        case .Began:</span><br><span class="line">            sender.setTranslation(CGPointMake(0, 0), inView: container)</span><br><span class="line">        case .Changed:</span><br><span class="line">            let point = sender.translationInView(container)</span><br><span class="line">            </span><br><span class="line">            let per = point.x / CGRectGetWidth(container.bounds)</span><br><span class="line">            self.updateInteractiveTransition(per)</span><br><span class="line">            print(per)</span><br><span class="line">        case .Ended:</span><br><span class="line">            self.finishInteractiveTransition()</span><br><span class="line">            container.removeGestureRecognizer(sender)</span><br><span class="line">        default:</span><br><span class="line">            self.cancelInteractiveTransition()</span><br><span class="line">            container.removeGestureRecognizer(sender)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Creating-Animations-that-Run-Alongside-a-Transition"><a href="#Creating-Animations-that-Run-Alongside-a-Transition" class="headerlink" title="Creating Animations that Run Alongside a Transition"></a>Creating Animations that Run Alongside a Transition</h6><p>视图控制器在执行transition的过程中，有可能需要调整自身的视图层次结构，或者调用动画给予界面可视反馈。在transition过程中会存在一个transition coordinator对象，通过视图控制器transitionCoordinator属性获取，调用对象 animateAlongsideTransition:completion: or animateAlongsideTransitionInView:animation:completion:方法创建动画。</p>
<h2 id="Creating-Custom-Presentations"><a href="#Creating-Custom-Presentations" class="headerlink" title="Creating Custom Presentations"></a>Creating Custom Presentations</h2><p>UIKit框架分离视图控制器的内容呈现和展示在屏幕上两个部分。底层的presentation controller对象管理被呈现的视图控制器，该控制器对象还管理视图控制器的视图呈现方式，presentation controller对象可能负责的任务：</p>
<ol>
<li>设置被呈现的视图控制器的大小。</li>
<li>添加自定义的视图用于改变被呈现内容的可视效果。</li>
<li>提供自定义视图的过渡动画。</li>
<li>当应用的当前状态环境发生变化时presentation起到适配的可视效果作用。</li>
</ol>
<h4 id="Custom-Presentation-Process"><a href="#Custom-Presentation-Process" class="headerlink" title="Custom Presentation Process"></a>Custom Presentation Process</h4><p>当呈现的视图控制器presentation方式被设置为UIModalPresentationCustom时，UIKit框架寻找自定义的presentation控制器管理呈现过程。</p>
<p>presentation控制器伴随着过渡效果整个过程，animator对象操作视图控制器内容的动画，而presentation控制器操作其它的操作。被animator对象操作的视图可以通过复写presentedView()方法改变。</p>
<p>presentation呈现过程：</p>
<ol>
<li>调用过渡代理对象presentationControllerForPresentedViewController:presentingViewController:sourceViewController:取得自定义的presentation控制器。</li>
<li>寻问过渡代理对象的animator和interactive animater对象。</li>
<li>调用presentation控制器 presentationTransitionWillBegin方法。<strong>可以在该方法内添加自定义的视图，设置视图层次结构</strong></li>
<li>调用presentedView()方法获取由animator对象操作的视图。<strong>默认情况下，返回的是被呈现视图控制器的根视图。程序也可以自定义其它视图，但是必须将被呈现的视图控制器的根视图合成到视图层次结构中</strong>。</li>
<li>执行过渡动画。在此过程中UIKit框架会调用containerViewWillLayoutSubviews and containerViewDidLayoutSubviews方法让presentation控制器可以布局自定义视图。</li>
<li>调用 presentationTransitionDidEnd:方法。</li>
</ol>
<p>消失过程：</p>
<ol>
<li>从当前可视的视图控制器获取presentation控制器。</li>
<li>寻问过渡代理对象的animator和interactive animater对象。</li>
<li>调用presentation控制器 presentationTransitionWillBegin方法。<strong>可以在该方法内添加自定义的视图，设置视图层次结构</strong>。</li>
<li>调用presentedView()方法获取由animator对象操作的视图。</li>
<li>执行过渡动画。在此过程中UIKit框架会调用containerViewWillLayoutSubviews and containerViewDidLayoutSubviews方法让presentation控制器可以布局自定义视图。</li>
<li>调用 presentationTransitionDidEnd:方法。</li>
</ol>
<p><strong>在处理过程中， frameOfPresentedViewInContainerView and presentedView方法可能会被多次调用，方法应该尽快完成处理</strong></p>
<h4 id="Creating-a-Custom-Presentation-Controller"><a href="#Creating-a-Custom-Presentation-Controller" class="headerlink" title="Creating a Custom Presentation Controller"></a>Creating a Custom Presentation Controller</h4><p>设置启动需要的步骤，可以采用内置的过渡动画；由于在呈现时UITransitionContextFromViewKey和消失时UITransitionContextToViewKey对应的值都为nil，所以记录一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@objc private func buttonTouched(sender : UIButton) &#123;</span><br><span class="line">    let presentedVC = PresentedViewController()</span><br><span class="line">    presentedVC.transitioningDelegate = self</span><br><span class="line">    presentedVC.modalPresentationStyle = .Custom</span><br><span class="line">    self.presentViewController(presentedVC, animated: true, completion: nil)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func animationControllerForPresentedController(presented: UIViewController, presentingController presenting: UIViewController, sourceController source: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</span><br><span class="line">    return PreCPAnimator()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func animationControllerForDismissedController(dismissed: UIViewController) -&gt; UIViewControllerAnimatedTransitioning? &#123;</span><br><span class="line">    animator.presenting = false</span><br><span class="line">    return PreCDAnimator()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func presentationControllerForPresentedViewController(presented: UIViewController, presentingViewController presenting: UIViewController, sourceViewController source: UIViewController) -&gt; UIPresentationController? &#123;</span><br><span class="line">    let presentation = CustomPresentationController(presentedViewController: presented, presentingViewController: presenting)</span><br><span class="line">    </span><br><span class="line">    return presentation</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">class CustomPresentationController: UIPresentationController &#123;</span><br><span class="line">    </span><br><span class="line">    let dimmingView : UIView</span><br><span class="line">    </span><br><span class="line">    override init(presentedViewController: UIViewController, presentingViewController: UIViewController) &#123;</span><br><span class="line">        dimmingView = UIView()</span><br><span class="line">        dimmingView.backgroundColor = UIColor.init(white: 0.0, alpha: 0.4)</span><br><span class="line">        dimmingView.alpha = 0.0</span><br><span class="line">        </span><br><span class="line">        super.init(presentedViewController: presentedViewController, presentingViewController: presentingViewController)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func frameOfPresentedViewInContainerView() -&gt; CGRect &#123;</span><br><span class="line">        let bounds = self.containerView!.bounds</span><br><span class="line">        </span><br><span class="line">        return CGRectInset(bounds, 30, 30)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func presentationTransitionWillBegin() &#123;</span><br><span class="line">        let containerView = self.containerView!</span><br><span class="line">        </span><br><span class="line">        dimmingView.frame = containerView.bounds</span><br><span class="line">        dimmingView.alpha = 0.0</span><br><span class="line">        </span><br><span class="line">        containerView.insertSubview(dimmingView, atIndex: 0)</span><br><span class="line">        </span><br><span class="line">        if let coordinator = presentedViewController.transitionCoordinator() &#123;</span><br><span class="line">            coordinator.animateAlongsideTransition(&#123; (context) in</span><br><span class="line">                self.dimmingView.alpha = 1.0</span><br><span class="line">                &#125;, completion: nil)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            dimmingView.alpha = 1.0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func dismissalTransitionWillBegin() &#123;</span><br><span class="line">        if let coordiantor = presentedViewController.transitionCoordinator() &#123;</span><br><span class="line">            coordiantor.animateAlongsideTransition(&#123; (context) in</span><br><span class="line">                self.dimmingView.alpha = 0.0</span><br><span class="line">                &#125;, completion: nil)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            dimmingView.alpha = 0.0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func dismissalTransitionDidEnd(completed: Bool) &#123;</span><br><span class="line">        if completed &#123;</span><br><span class="line">            dimmingView.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PreCPAnimator: NSObject, UIViewControllerAnimatedTransitioning &#123;</span><br><span class="line">    </span><br><span class="line">    func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -&gt; NSTimeInterval &#123;</span><br><span class="line">        return 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func animateTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</span><br><span class="line">        let containerView = transitionContext.containerView()!</span><br><span class="line">        let toVC = transitionContext.viewControllerForKey(UITransitionContextToViewControllerKey)!</span><br><span class="line">        </span><br><span class="line">        let toView = transitionContext.viewForKey(UITransitionContextToViewKey)!</span><br><span class="line">        </span><br><span class="line">        let containerFrame = containerView.frame</span><br><span class="line">        var toViewStartFrame = transitionContext.initialFrameForViewController(toVC)</span><br><span class="line">        let toViewFinalFrame = transitionContext.finalFrameForViewController(toVC)</span><br><span class="line">        </span><br><span class="line">        toViewStartFrame.origin.x = containerFrame.size.width</span><br><span class="line">        toViewStartFrame.origin.y = containerFrame.size.height</span><br><span class="line">        containerView.addSubview(toView)</span><br><span class="line">        toView.frame = toViewStartFrame</span><br><span class="line">        </span><br><span class="line">        UIView.animateWithDuration(self.transitionDuration(transitionContext), animations: &#123;</span><br><span class="line">            toView.frame = toViewFinalFrame</span><br><span class="line">        &#125;) &#123; (finished) in</span><br><span class="line">            let success = !transitionContext.transitionWasCancelled()</span><br><span class="line">            </span><br><span class="line">            transitionContext.completeTransition(success)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class PreCDAnimator: NSObject, UIViewControllerAnimatedTransitioning &#123;</span><br><span class="line">    var presenting : Bool = false</span><br><span class="line">    </span><br><span class="line">    func transitionDuration(transitionContext: UIViewControllerContextTransitioning?) -&gt; NSTimeInterval &#123;</span><br><span class="line">        return 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func animateTransition(transitionContext: UIViewControllerContextTransitioning) &#123;</span><br><span class="line">        let fromVC = transitionContext.viewControllerForKey(UITransitionContextFromViewControllerKey)!</span><br><span class="line">        </span><br><span class="line">        let containerView = transitionContext.containerView()!</span><br><span class="line">        let fromView = transitionContext.viewForKey(UITransitionContextFromViewKey)!</span><br><span class="line">        </span><br><span class="line">        let containerFrame = containerView.frame</span><br><span class="line">        var fromViewFinalFrame = transitionContext.finalFrameForViewController(fromVC)</span><br><span class="line">        </span><br><span class="line">        fromViewFinalFrame.origin.x = containerFrame.width</span><br><span class="line">        fromViewFinalFrame.origin.y = containerFrame.height</span><br><span class="line">        </span><br><span class="line">        UIView.animateWithDuration(self.transitionDuration(transitionContext), animations: &#123;</span><br><span class="line">            fromView.frame = fromViewFinalFrame</span><br><span class="line">        &#125;) &#123; (finished) in</span><br><span class="line">            let success = !transitionContext.transitionWasCancelled()</span><br><span class="line">            </span><br><span class="line">            transitionContext.completeTransition(success)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/21/ViewController2-PG/" data-id="cinkcpnmu001h2kfyi6oa3e84" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/22/ViewController3-PG/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ViewController3-PG
        
      </div>
    </a>
  
  
    <a href="/2016/04/20/ViewController-PG/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ViewController-PG</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/">OS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Other/">Other</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pattern/">Pattern</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端/">后端</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/OS/" style="font-size: 10px;">OS</a> <a href="/tags/Other/" style="font-size: 10px;">Other</a> <a href="/tags/Pattern/" style="font-size: 15px;">Pattern</a> <a href="/tags/Swift/" style="font-size: 17.5px;">Swift</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/后端/" style="font-size: 17.5px;">后端</a> <a href="/tags/工具/" style="font-size: 12.5px;">工具</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/23/AutoLayout-PG/">AutoLayout_PG</a>
          </li>
        
          <li>
            <a href="/2016/04/22/ViewController3-PG/">ViewController3-PG</a>
          </li>
        
          <li>
            <a href="/2016/04/21/ViewController2-PG/">ViewController2-PG</a>
          </li>
        
          <li>
            <a href="/2016/04/20/ViewController-PG/">ViewController-PG</a>
          </li>
        
          <li>
            <a href="/2016/04/18/View-PG/">View-PG</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 天晷<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>